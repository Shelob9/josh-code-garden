<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@JoshBotDotJs"/><meta name="twitter:creator" content="@josh412"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:site_name" content="Code Meadow"/><title>Github Actions For Vercel | Code Meadow</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="I am using Jest to run tests for a [[nextjs]] site on Vercel using three strategies:

1. Import the component that a page runs and test with [[jest]] and [@testing-library](https://testing-library.com/docs/react-testing-library/intro).
2"/><meta property="og:title" content="Github Actions For Vercel"/><meta property="og:description" content="Notes about Github Actions For Vercel by Josh Pollock"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/d775fab888e97a088f8d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d775fab888e97a088f8d.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-6af9946a2519c79c69af.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.0aee811b7a2ba0b587bf.js" as="script"/><link rel="preload" href="/_next/static/chunks/eeb0540607e8d823f414da745296801d6a447ba7.481ce1df83e29fdab985.js" as="script"/><link rel="preload" href="/_next/static/chunks/e9acf14add5c4f122717233c5b8bc320320f96b1.af08081eb2a8a0707206.js" as="script"/><link rel="preload" href="/_next/static/chunks/3a4d373e4f729ad3d1487c5b24727311a83f72b6.a6e4cceaacf75dd96edb.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-737febf5088f37bd4af8.js" as="script"/><link rel="preload" href="/_next/static/chunks/cf2f3e6cb2c7250386e9cd655729b7b20c55eb51.c4fc838959c470884ff9.js" as="script"/><link rel="preload" href="/_next/static/chunks/65446de8fdf4c7aed854cb7642630d677689ed10.ac9293b36ba061acc35f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/notes/%5Bslug%5D-cc63db50d5065760d96a.js" as="script"/></head><body><div id="__next"><div class="layout"><header id="header" role="banner"><a aria-current="page" class="" href="/"><span>Code Meadow</span></a><div class="controls"><button title="Show Graph Visualization" aria-label="Show Graph Visualization" class="graph-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" class="graph-closed"><g fill="none" stroke-width="2"><circle cx="11.733" cy="3.181" r="1.902"></circle><circle cx="16.864" cy="10.861" r="1.902"></circle><circle cx="7.47" cy="16.822" r="1.902"></circle><circle cx="3.046" cy="6.275" r="1.902"></circle><circle cx="9.372" cy="10.861" r="1.902"></circle><line x1="11.635" x2="14.655" y1="10.861" y2="10.861"></line><line x1="10" x2="10.895" y1="8.959" y2="5.573"></line><line x1="7.47" x2="4.5" y1="9.68" y2="7.5"></line><line x1="8.25" x2="8.809" y1="14.92" y2="13.088"></line></g></svg></button><label class="dark-mode-toggle" aria-label="Activate dark mode" title="Activate dark mode"><input type="checkbox" checked=""/><div></div></label></div></header><main><div class="note-columns-scrolling-container"><div class="note-columns-container"><div class="note-container note-open note-focus visible note-position-one"><div class="note-buttons"></div><div id="" class="note-content"><h1 class="animate-pulse">Github Actions For Vercel</h1><div class="prose note-markdown"><p class="mb-4"> <!-- -->I am using Jest to run tests for a <a href="/notes/nextjs">nextjs</a> site on Vercel using three strategies:</p>
<ol>
<li>Import the component that a page runs and test with <a href="/notes/jest">jest</a> and <a href="https://testing-library.com/docs/react-testing-library/intro">@testing-library</a>.</li>
<li>Use Jest to unit test utility functions my API routes use.</li>
<li>Use fetch to call the API routes and test results.</li>
</ol>
<h2 class="mb-4"> <!-- -->Testing Vercel API routes</h2>
<p class="mb-4"> <!-- -->This approach is inspired by <a href="/notes/laravel">laravel</a><a href="https://laravel.com/docs/7.x/http-tests">http testing</a>//laravel.com/docs/7.x/http</p>
<p class="mb-4"> <!-- -->At first I hardcoded the URL for my current PR&#x27;s preview URL into the Github action.</p>
<pre><code>let appUrl = &quot;https://whatever.jpollock412.vercel.app&quot;;
test(&quot;Gets a 200&quot;, async () =&gt; {
	expect.assertions(1);
	await fetch(`${appUrl}/api/hello`)
		.then((r) =&gt; {
			expect(r.status).toBe(200);
		})
		.catch((e) =&gt; console.log(e));
});
</code></pre>
<p class="mb-4"> <!-- -->That only worked beacuse I already had the PR. It&#x27;s not reusable between PRs. Also, it runs the test on the previous commit in the likely case the Github action runs before the deployment is completed. I used <a href="https://github.com/patrickedqvist/wait-for-vercel-preview">this action to wait for the preview URL to update</a></p>
<h2 class="mb-4"> <!-- -->Trigger A Deployment From Another Repostiory</h2>
<ul class="mb-4 list-inside list-disc">
<li><a href="https://vercel.com/docs/more/deploy-hooks">Vercel Deploy Hooks</a></li>
<li><a href="https://docs.github.com/en/actions/reference/encrypted-secrets">Github Secrets</a></li>
<li><a href="https://github.com/marketplace/actions/github-action-for-curl">curl Github Action</a>
This git repo manages content for a <a href="https://garden.joshpress.net">garden.joshpress.net</a>. The source code for that site is in a different repo. Pushing to that repo triggers deployment on Vercel.</li>
</ul>
<p class="mb-4"> <!-- -->I set up a <a href="https://vercel.com/docs/more/deploy-hooks">build hook</a> on reference and then used a Github action to call it when this repo is pushed to. I used a Github repo secret for the deploy hook URL for security. If you look through the git history of this repo, you will see a hardcoded webhook URL. Then I remembered you can do that beacuse it&#x27;s public. So I revoked that webhook and made a new one for the secret.</p>
<pre><code>name: Meadow Halloween [CD]

on:
  push:
    branches: [master]

jobs:
  curl:
    runs-on: ubuntu-latest
    steps:
      # Trigger vercel webhook
      - name: Vercel Deploy
        uses: wei/curl@master
		with:
          args: ${{ secrets.VERCEL_DEPLOY_HOOK }}
</code></pre></div></div></div><div class="note-container note-closed  invisible note-position-two"><div id="" class="note-content"></div></div><div class="note-container note-closed  invisible note-position-three"><div id="" class="note-content"></div></div></div></div></main><footer class="bg-white dark:bg-gray-300 border-t border-gray-500 shadow"><div class="container mx-auto flex py-8"><div class="w-full mx-auto flex flex-wrap"><div class="flex w-full lg:w-1/2 "><div class="px-8"><h3 class="font-bold text-gray-900"><a href="/about">About</a></h3><p class="py-4 text-gray-600 text-sm">By <!-- -->Josh Pollock<!-- -->. Built with <a href="https://digitalgardenbuilder.app/" target="_blank" rel="noopener noreferrer">Digital Garden Builder</a></p></div></div><div class="flex w-full lg:w-1/2 lg:justify-end lg:text-right"><div class="px-8"><h3 class="font-bold text-gray-900">Social</h3><ul class="list-reset items-center text-sm pt-3"><li><a class="inline-block text-gray-600 no-underline hover:text-gray-900 hover:underline py-1" href="https://twitter.com/@josh412">Twitter</a></li></ul></div></div><div class="flex w-full lg:justify-end lg:text-right"></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"title":"Github Actions For Vercel","content":"I am using Jest to run tests for a [[nextjs]] site on Vercel using three strategies:\r\n\r\n1. Import the component that a page runs and test with [[jest]] and [@testing-library](https://testing-library.com/docs/react-testing-library/intro).\r\n2. Use Jest to unit test utility functions my API routes use.\r\n3. Use fetch to call the API routes and test results.\r\n\r\n## Testing Vercel API routes\r\n\r\nThis approach is inspired by [[laravel]][http testing](https://laravel.com/docs/7.x/http-tests)//laravel.com/docs/7.x/http\r\n\r\nAt first I hardcoded the URL for my current PR's preview URL into the Github action.\r\n\r\n```js\r\nlet appUrl = \"https://whatever.jpollock412.vercel.app\";\r\ntest(\"Gets a 200\", async () =\u003e {\r\n\texpect.assertions(1);\r\n\tawait fetch(`${appUrl}/api/hello`)\r\n\t\t.then((r) =\u003e {\r\n\t\t\texpect(r.status).toBe(200);\r\n\t\t})\r\n\t\t.catch((e) =\u003e console.log(e));\r\n});\r\n```\r\n\r\nThat only worked beacuse I already had the PR. It's not reusable between PRs. Also, it runs the test on the previous commit in the likely case the Github action runs before the deployment is completed. I used [this action to wait for the preview URL to update](https://github.com/patrickedqvist/wait-for-vercel-preview)\r\n\r\n## Trigger A Deployment From Another Repostiory\r\n\r\n- [Vercel Deploy Hooks](https://vercel.com/docs/more/deploy-hooks)\r\n- [Github Secrets](https://docs.github.com/en/actions/reference/encrypted-secrets)\r\n- [curl Github Action](https://github.com/marketplace/actions/github-action-for-curl)\r\n  This git repo manages content for a [garden.joshpress.net](https://garden.joshpress.net). The source code for that site is in a different repo. Pushing to that repo triggers deployment on Vercel.\r\n\r\nI set up a [build hook](https://vercel.com/docs/more/deploy-hooks) on reference and then used a Github action to call it when this repo is pushed to. I used a Github repo secret for the deploy hook URL for security. If you look through the git history of this repo, you will see a hardcoded webhook URL. Then I remembered you can do that beacuse it's public. So I revoked that webhook and made a new one for the secret.\r\n\r\n```yml\r\nname: Meadow Halloween [CD]\r\n\r\non:\r\n  push:\r\n    branches: [master]\r\n\r\njobs:\r\n  curl:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      # Trigger vercel webhook\r\n      - name: Vercel Deploy\r\n        uses: wei/curl@master\r\n\t\twith:\r\n          args: ${{ secrets.VERCEL_DEPLOY_HOOK }}\r\n```\r\n","slug":"gh-actions-vercel","references":[{"slug":"jest","url":"/notes/jest"},{"slug":"laravel","url":"/notes/laravel"}]},"slug":"gh-actions-vercel"},"__N_SSG":true},"page":"/notes/[slug]","query":{"slug":"gh-actions-vercel"},"buildId":"UYb4TZiTjdG1bojDP_Cju","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-695197e122f3a846e5cd.js"></script><script src="/_next/static/chunks/main-6af9946a2519c79c69af.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.0aee811b7a2ba0b587bf.js" async=""></script><script src="/_next/static/chunks/eeb0540607e8d823f414da745296801d6a447ba7.481ce1df83e29fdab985.js" async=""></script><script src="/_next/static/chunks/e9acf14add5c4f122717233c5b8bc320320f96b1.af08081eb2a8a0707206.js" async=""></script><script src="/_next/static/chunks/3a4d373e4f729ad3d1487c5b24727311a83f72b6.a6e4cceaacf75dd96edb.js" async=""></script><script src="/_next/static/chunks/pages/_app-737febf5088f37bd4af8.js" async=""></script><script src="/_next/static/chunks/cf2f3e6cb2c7250386e9cd655729b7b20c55eb51.c4fc838959c470884ff9.js" async=""></script><script src="/_next/static/chunks/65446de8fdf4c7aed854cb7642630d677689ed10.ac9293b36ba061acc35f.js" async=""></script><script src="/_next/static/chunks/pages/notes/%5Bslug%5D-cc63db50d5065760d96a.js" async=""></script><script src="/_next/static/UYb4TZiTjdG1bojDP_Cju/_buildManifest.js" async=""></script><script src="/_next/static/UYb4TZiTjdG1bojDP_Cju/_ssgManifest.js" async=""></script></body></html>